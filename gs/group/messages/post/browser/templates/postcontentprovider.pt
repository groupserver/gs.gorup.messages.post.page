<div role="article"
  tal:define="munge_date python:modules['Products.XWFCore.XWFUtils'].munge_date;
              change_tz python:modules['Products.XWFCore.XWFUtils'].change_timezone;"
  tal:attributes="class string:hentry ${view/cssClass}; 
                  id string:post-${view/post/post_id};
                  aria-labelledby string:post-${view/post/post_id}-title">
  <div class="email-metadata" role="complementary">
    <a class="topic entry-title" role="heading"
       tal:attributes="id string:post-${view/post/post_id}-title;
                       href string:/r/topic/${view/post/post_id}#post-${view/post/post_id};"
       tal:content="view/topicName">A Topic</a>
    <strong class="author vcard">
      <a class="fn url"
         tal:omit-tag="view/authorInfo/anonymous"
         tal:attributes="href view/authorInfo/url;
                         title string:Profile of ${view/authorInfo/name};"
         tal:content="view/authorInfo/name">Me!</a>
    </strong><!--vcard-->
    <span class="posted minor"
          tal:define="pd view/post/date;
                      d python:change_tz(pd, 'UTC').replace(microsecond=0);
                      date python:munge_date(view.context, pd)">
      Posted at
      <abbr class="date updated published"
            title="Stuff"
            tal:attributes="title string:${d/isoformat}Z">
        <em tal:content="date">Today, Tomorrow, Timaru</em>
      </abbr>
    </span><!--posted-->
    <div class="gs-group-messages-post-buttons btn-toolbar" 
         role="toolbar" aria-label="Post Actions"
         tal:condition="not:view/post/hidden">
      <a class="gs-content-js-share btn btn-small" role="button" 
         aria-haspopup="true"         
         tal:attributes="href string:${view/siteInfo/url}/r/post/${view/post/post_id};
                         title string:${view/post/subject};
                         public python:view.isPublic and 1 or 0">Share</a>
      <button class="hide-button btn btn-small" role="button" 
              aria-haspopup="true" tal:condition="view/canHide">Hide</button>
    </div><!--gs-group-messages-post-buttons-->
  </div><!--email-metadata-->
  <div tal:condition="view/showPhoto"
       tal:define="user view/authorInfo/user"
       tal:replace="structure provider:groupserver.UserImage"/>
  <div tal:condition="view/post/hidden"
       class="disclosureWidget hidden-post">
    <p class="minor">
      <a class="disclosureButton" href="#">Hidden</a>
    </p>
    <div tal:condition="view/post/hidden"
         class="hidden-msg disclosureShowHide" style="display:none;">
      <p class="vcard">
        Sorry, this post is hidden.
        The reason that 
        <a class="fn"  href="#"
           tal:define="u view/hiddenPostInfo/adminInfo" 
           tal:attributes="href u/url"
           tal:content="u/name">an admin</a> 
        gave for hiding the post is as follows.
      </p><!--vcard-->
      <blockquote>
        <p tal:content="view/hiddenPostInfo/reason">
          Too many turtles.
        </p>
      </blockquote>
      <p>
        If you think you should be able to see the post
        <a href="#"
           tal:attributes="href view/hiddenSupportEmail"
           class="email">email support</a> 
        and we will see what we can do to help.
      </p>
    </div><!--hidden-msg-->
  </div><!--hidden-post-->
  <div tal:condition="not:view/post/hidden" class="email-message" >
    <pre class="email-body entry-content" 
         tal:content="structure view/postIntro">
      This is the body of the document.
    </pre><!--email-body-->
    <div class="email-remainder muted"
         tal:condition="python:view.postRemainder.strip()"
         tal:define="remId string:emailRemainder${view/post/post_id};
                     discloseId string:emailDiscloseButton${view/post/post_id}">
      <div class="disclosureWidget" 
           tal:attributes="id remId">
        <p>
          <a class="disclosureButton" role="button"
             tal:attributes="href string:javascript:showHideDisclosure('${remId}');
                             aria-controls string:${remId}-text;"
             href="#">Rest of post</a>
        </p>
        <div class="disclosureShowHide" style="display:none;"
             tal:attributes="id string:${remId}-text">
          <pre tal:content="structure view/postRemainder">
            This is the remainder of the email, with such things as 
            the footer.
          </pre>
        </div><!--disclosureShowHide-->
      </div><!--disclosureWidget-->
    </div><!--email-remainder-->      
    <div class="fileNotification" role="list"
         tal:condition="view/post/files_metadata"
         tal:define="fms view/post/files_metadata">
      <tal:block repeat="fm fms">
        <div class="fileMetadata"
             tal:define="isImage python:'image' in fm['mime_type']"
             tal:attributes="role python:'listitem img' if isImage else 'listitem'"
             role="listitem">
          <div tal:condition="isImage" class="thumb">
            <a href="#" tal:attributes="href string:/r/img/${fm/file_id}">
              <img src="#"
                   tal:attributes="src string:/r/file/${fm/file_id}/resize/196/196/${fm/file_name}"/>
            </a>
          </div><!--thumb-->
          <div class="info"
               tal:define="t fm/mime_type; 
                           iconName python:t.replace('/','-').replace('.','-').strip(); 
                           img python:(('image' in fm['mime_type']) and 'img') or 'file'">
            <a href="#" title="foo"
               tal:attributes="type fm/mime_type;
                               href string:/r/${img}/${fm/file_id}/${fm/file_name};
                               class string:fileIcon ${iconName};">&#160;</a>
            <a class="file" href="/favicon.ico" 
               type="application/octet-stream"
               tal:attributes="type fm/mime_type;
                               href string:/r/${img}/${fm/file_id}/${fm/file_name};
                               class string:fileName ${iconName};"
               tal:content="fm/file_name">Filename</a>
            <span tal:attributes="title string:${fm/file_size}B"
                  tal:define="k python:u'%.0f'%(fm['file_size']/1024.0)"
                  class="size muted">(<span class="val" 
                                            tal:content="k">-1</span>KB)</span>
          </div><!--info-->
        </div><!--fileMetadata-->
      </tal:block>
    </div><!--fileNotification-->
  </div><!--email-message-->
</div><!--hentry-->

